# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Gasnet.org is a Docusaurus-powered documentation site for HPC networking, PGAS runtimes, and performance engineering. The site uses React 19, Docusaurus 3.9, and includes custom visualizations with Chart.js, Mermaid diagrams, and KaTeX math rendering.

## Development Commands

```bash
npm install           # Install dependencies
npm run start        # Start dev server (localhost:3000)
npm run build        # Production build to build/ directory
npm run serve        # Serve built site locally (after build)
npm run clear        # Clear Docusaurus cache
npm run audit        # Check for security vulnerabilities
npm run audit:fix    # Auto-fix vulnerabilities where possible
```

## Security

See `SECURITY.md` for comprehensive security documentation.

### Environment Variables

Copy `.env.example` to `.env.local` for local development:

| Variable             | Description                                       |
| -------------------- | ------------------------------------------------- |
| `GISCUS_REPO`        | GitHub repository for comments (e.g., `org/repo`) |
| `GISCUS_REPO_ID`     | Giscus repository ID from https://giscus.app      |
| `GISCUS_CATEGORY`    | Discussion category name (default: `General`)     |
| `GISCUS_CATEGORY_ID` | Giscus category ID                                |

**IMPORTANT**: Never commit `.env` or `.env.local` files.

### Security Headers

Security headers are defined in `docusaurus.config.js` but must be configured on your web server. See `server-configs/` for platform-specific configurations:

- `vercel.json` - Copy to root for Vercel deployment
- `netlify.toml` - Copy to root for Netlify deployment
- `nginx.conf` - nginx configuration example
- `apache-htaccess.conf` - Apache .htaccess example

## Architecture

### Directory Structure

```
src/
├── components/          # React components (must use BrowserOnly for client-side code)
│   ├── BenchmarkChart.js        # Chart.js bar charts
│   ├── CaseStudyCharts.js       # Case study visualizations
│   └── GiscusComponent.js       # GitHub-based comments
├── css/
│   └── custom.css       # Global styles, theming, grid backgrounds
├── pages/
│   └── index.js         # Homepage
└── theme/
    └── DocItem/Footer/  # Swizzled component for adding Giscus to doc pages
docs/
├── 01-getting-started/
├── 02-architecture/
├── 03-programming-model/
├── 04-interop/
├── 05-benchmarks/
├── 06-glossary/
└── 07-case-studies/
static/
├── img/                # Images, logos, icons
└── data/               # JSON data for benchmarks/charts
```

### Key Patterns

1. **Auto-generated Sidebars**: Sidebars use `type: 'autogenerated'` - docs structure from filesystem determines navigation
2. **Numbered Folders**: Docs use `01-`, `02-` prefixes for ordering; `_category_.json` files configure each section
3. **Theme Swizzling**: `src/theme/DocItem/Footer/` extends Docusaurus's Footer to inject Giscus comments
4. **Client-Side Components**: All components using browser APIs (Chart.js, Giscus) must wrap in `<BrowserOnly>`
5. **Color Mode**: Use `useColorMode()` hook for theme-aware components; custom colors defined in `custom.css`

### Content Features

- **Mermaid diagrams**: Enabled via `@docusaurus/theme-mermaid`
- **KaTeX math**: remark-math + rehype-katex plugins
- **Local search**: `@easyops-cn/docusaurus-search-local` (indexes pages, not blog)
- **Charts**: Chart.js via custom components (BenchmarkChart, CaseStudyCharts)
- **Comments**: Giscus integration (requires repo ID configuration)

## Configuration Files

- `docusaurus.config.js`: Site config, presets, themes, navbar/footer
- `sidebars.js`: Auto-generated sidebar config (single line, rarely needs changes)
- `src/css/custom.css`: Theme variables, grid backgrounds, gradient effects

## Deployment

Built to `build/` directory. Configured for Vercel deployment (see `DEPLOYMENT.md`). Domain: gasnet.org

## Giscus Setup

The `src/components/GiscusComponent.js` reads Giscus configuration from environment variables. To enable comments:

1. Visit https://giscus.app to generate your configuration
2. Set the following environment variables in your deployment platform or `.env.local`:
   - `GISCUS_REPO` - Your GitHub repository (e.g., `org/repo`)
   - `GISCUS_REPO_ID` - Repository ID from Giscus
   - `GISCUS_CATEGORY` - Discussion category (default: `General`)
   - `GISCUS_CATEGORY_ID` - Category ID from Giscus
